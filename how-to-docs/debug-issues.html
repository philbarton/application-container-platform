


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.1.7">
    
    
      
        <title>Debug issues - Application Container Platform</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4c7052ca.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#debug-issues-with-your-deployments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Application Container Platform" class="md-header-nav__button md-logo" aria-label="Application Container Platform">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Application Container Platform
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Debug issues
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Application Container Platform" class="md-nav__button md-logo" aria-label="Application Container Platform">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Application Container Platform
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../services.html" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://gitlab.digital.homeoffice.gov.uk/acp-docs/acp-support/tree/master/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="How To's" class="md-nav__link">
      How To's
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../developer-docs/index.html" title="Developer Getting Started Guide" class="md-nav__link">
      Developer Getting Started Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../newuser.html" title="New User Guide" class="md-nav__link">
      New User Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rbac.html" title="RBAC Guide" class="md-nav__link">
      RBAC Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../external-addresses.html" title="ACP External IPs" class="md-nav__link">
      ACP External IPs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../service-lifecycle.html" title="Service Lifecycle" class="md-nav__link">
      Service Lifecycle
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#debug-issues-with-your-deployments" class="md-nav__link">
    Debug Issues with your deployments
  </a>
  
    <nav class="md-nav" aria-label="Debug Issues with your deployments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debug-with-secrets" class="md-nav__link">
    Debug with secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-issues-with-your-deployments-to-the-platform" class="md-nav__link">
    Debugging issues with your deployments to the platform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-deployments" class="md-nav__link">
    Debugging deployments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-check-your-deployment-replicaset-and-pods-created-properly" class="md-nav__link">
    1. Check your deployment, replicaset and pods created properly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-investigate-potential-issues-with-your-pods-this-is-most-likely" class="md-nav__link">
    2. Investigate potential issues with your pods (this is most likely)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-investigate-potential-issues-with-your-service" class="md-nav__link">
    3. Investigate potential issues with your service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-investigate-potential-issues-with-ingress" class="md-nav__link">
    4. Investigate potential issues with ingress
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>Debug issues</h1>
                
                <h2 id="debug-issues-with-your-deployments">Debug Issues with your deployments<a class="headerlink" href="#debug-issues-with-your-deployments" title="Permanent link">#</a></h2>
<h4 id="debug-with-secrets">Debug with secrets<a class="headerlink" href="#debug-with-secrets" title="Permanent link">#</a></h4>
<p>Sometimes your app doesn't want to talk to an API or a DB and you've stored the credentials or just the details of that in secret.</p>
<p>The following approaches can be used to validate that your secret is set correctly</p>
<pre><code class="bash">$ kubectl exec -ti my-pod -c my-container -- mysql -h\$DBHOST -u\$DBUSER -p\$DBPASS
## or
$ kubectl exec -ti my-pod -c my-container -- openssl verify /secrets/certificate.pem
## or
$ kubectl exec -ti my-pod -c my-container bash
## and you'll naturally have all the environment variables set and volumes mounted.
## however we recommend against outputing them to the console e.g. echo $DBHOST
## instead if you want to assert a variable is set correctly use
$ [[ -z $DBHOST ]]; echo $?
## if it returns 1 then the variable is set.
</code></pre>

<h4 id="debugging-issues-with-your-deployments-to-the-platform">Debugging issues with your deployments to the platform<a class="headerlink" href="#debugging-issues-with-your-deployments-to-the-platform" title="Permanent link">#</a></h4>
<p>If you get to the end of the above guide but can't access your application there are a number of places something could be going wrong.
This section of the guide aims to give you some basic starting points for how to debug your application.</p>
<h4 id="debugging-deployments">Debugging deployments<a class="headerlink" href="#debugging-deployments" title="Permanent link">#</a></h4>
<p>We suggest the following steps:</p>
<h4 id="1-check-your-deployment-replicaset-and-pods-created-properly">1. Check your deployment, replicaset and pods created properly<a class="headerlink" href="#1-check-your-deployment-replicaset-and-pods-created-properly" title="Permanent link">#</a></h4>
<pre><code class="bash">$ kubectl get deployments
$ kubectl get rs
$ kubectl get pods
</code></pre>

<h4 id="2-investigate-potential-issues-with-your-pods-this-is-most-likely">2. Investigate potential issues with your pods (this is most likely)<a class="headerlink" href="#2-investigate-potential-issues-with-your-pods-this-is-most-likely" title="Permanent link">#</a></h4>
<p>If the get pods command shows that your pods aren't all running then this is likely where the issue is. You can then try curling your application to see if it is alive and responding as expected. e.g.</p>
<pre><code class="bash">$ curl localhost:4000
</code></pre>

<p>You can get further details on why the pods couldn't be deployed by running:</p>
<pre><code class="bash">$ kubectl describe pods *pods_name_here*
</code></pre>

<p>If your pods are running you can check they are operating as expected by <code>exec</code>ing into them (this gets you a shell on one of your containers).</p>
<pre><code class="bash">$ kubectl exec -ti *pods_name_here* -c *container_name_here* /bin/sh
</code></pre>

<blockquote>
<p><strong>Please note</strong> that the <code>-c</code> argument isn't needed if there is only one container in the pod.*</p>
</blockquote>
<h4 id="3-investigate-potential-issues-with-your-service">3. Investigate potential issues with your service<a class="headerlink" href="#3-investigate-potential-issues-with-your-service" title="Permanent link">#</a></h4>
<p>A good way to do this is to run a container in your namespace with a bash terminal:</p>
<pre><code class="bash">$ kubectl run -ti --image quay.io/ukhomeofficedigital/centos-base debugger bash
</code></pre>

<p>From this container you can then try curling your service. Your service will have a nice DNS name by default, so you can for example run:</p>
<pre><code class="bash">$ curl my-service-name
</code></pre>

<h4 id="4-investigate-potential-issues-with-ingress">4. Investigate potential issues with ingress<a class="headerlink" href="#4-investigate-potential-issues-with-ingress" title="Permanent link">#</a></h4>
<p>Minikube runs an ingress service using nginx. It's possible to ssh into the nginx container and cat the <code>nginx.conf</code> to inspect the configuration for nginx.</p>
<p>In order to attach to the nginx container, you need to know the name of the container:</p>
<pre><code class="shell">$ kubectl get pods
NAME                               READY     STATUS    RESTARTS   AGE
default-http-backend-2kodr         1/1       Running   1          5d
acp-hello-world-3757754181-x1kdu   1/1       Running   2          6d
ingress-3879072234-5f4uq           1/1       Running   2          5d
</code></pre>

<p>You can attach to the running container with:</p>
<pre><code class="bash">$ kubectl exec -ti &lt;ingress-3879072234-5f4uq&gt; -c &lt;proxy&gt; bash
</code></pre>

<p>where <code>&lt;proxy&gt;</code> is the container name of the nginx proxy inside the pod. You can find the name by describing the pod.</p>
<p>You're inside the container. You can cat the <code>nginx.conf</code> with:</p>
<pre><code class="bash">$ cat /etc/nginx/nginx.conf
</code></pre>

<p>You can also inspect the logs with:</p>
<pre><code class="bash">$ kubectl logs &lt;ingress-3879072234-5f4uq&gt;
</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.22b62ea4.min.js"></script>
      <script src="../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.f6ebf1dc.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>